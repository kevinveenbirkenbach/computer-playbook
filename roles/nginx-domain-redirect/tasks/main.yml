---
- name: recieve redirect source certificates
  command: certbot certonly --agree-tos --email {{administrator_email}} --non-interactive --webroot -w /var/lib/letsencrypt/ -d {{item.source}}
  loop: "{{domain_mappings}}"

- name: configure nginx redirect configurations
  vars:
    domain: "{{item.source}}"
    target_domain: "{{item.target}}"
  template: src=redirect.domain.nginx.conf.j2 dest={{nginx_servers_directory}}{{ domain }}.conf
  loop: "{{domain_mappings}}"
  notify: restart nginx
