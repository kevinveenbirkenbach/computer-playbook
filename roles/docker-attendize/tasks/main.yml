---
- name: receive {{ mail_interface_domain }} certificate
  command: certbot certonly --agree-tos --email {{ administrator_email }} --non-interactive --webroot -w /var/lib/letsencrypt/ -d {{ mail_interface_domain }}

- name: receive {{ domain }} certificate
  command: certbot certonly --agree-tos --email {{ administrator_email }} --non-interactive --webroot -w /var/lib/letsencrypt/ -d {{ domain }}

- name: configure {{domain}}.conf
  template: 
    src: roles/nginx-docker-reverse-proxy/templates/domain.conf.j2 
    dest: "{{nginx_servers_directory}}{{domain}}.conf"
  notify: restart nginx

#- name: configure {{ mail_interface_domain }}.conf
#  template: 
#    src: roles/nginx-docker-reverse-proxy/templates/domain.conf.j2 
#    dest: {{nginx_servers_directory}}{{ mail_interface_domain }}.conf
#  vars:
#    http_port: "{{ mail_interface_http_port }}"
#    domain:    "{{ mail_interface_domain }}"
#  notify: restart nginx

- name: "include tasks update-repository-with-docker-compose.yml"
  include_tasks: update-repository-with-docker-compose.yml