---
- name: include docker vars
  include_vars: vars/docker-database-service.yml.j2

- name: create central database
  include_role:
    name: docker-{{database_type}}
  when: enable_central_database | bool

- name: receive {{ mail_interface_domain }} certificate
  command: certbot certonly --agree-tos --email {{ administrator_email }} --non-interactive --webroot -w /var/lib/letsencrypt/ -d {{ mail_interface_domain }}

- name: receive {{ domain }} certificate
  command: certbot certonly --agree-tos --email {{ administrator_email }} --non-interactive --webroot -w /var/lib/letsencrypt/ -d {{ domain }}

- name: configure {{domain}}.conf
  template: 
    src: roles/nginx-docker-reverse-proxy/templates/domain.conf.j2 
    dest: "{{nginx_servers_directory}}{{domain}}.conf"
  notify: restart nginx

- name: "include tasks update-repository-with-docker-compose.yml"
  include_tasks: update-repository-with-docker-compose.yml